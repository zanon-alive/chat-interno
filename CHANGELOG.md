# Changelog

Todas as mudan√ßas not√°veis neste projeto ser√£o documentadas neste arquivo.

O formato √© baseado em [Keep a Changelog](https://keepachangelog.com/pt-BR/1.0.0/),
e este projeto adere ao [Semantic Versioning](https://semver.org/lang/pt-BR/).

---

## [2.0] - 2025-10-21

### üéâ Destaques da Release

Esta √© uma **release major** que introduz **Sistema White-Label completo** e **Dashboards Profissionais** com KPIs e gr√°ficos interativos. A interface administrativa foi completamente renovada com nova navega√ß√£o e experi√™ncia do usu√°rio.

### ‚ú® Adicionado

#### üé® Sistema White-Label
- **18 cores customiz√°veis** por inst√¢ncia:
  - Cor prim√°ria e hover
  - Cor secund√°ria e hover
  - Cores de fundo (prim√°rio, secund√°rio, terci√°rio)
  - Cores de texto (prim√°ria, secund√°ria, placeholder)
  - Cores de borda e hover
  - Cores de sucesso, erro, aviso e informa√ß√£o
- **Logo personalizado** com controle de dimens√µes (largura e altura)
- **Border-radius configur√°vel** (0-20px)
- **Fonte principal customiz√°vel** (Inter, Roboto, Open Sans, Lato, Montserrat)
- **Auditoria completa** de altera√ß√µes de tema (quem, quando, o que mudou)
- **Preview em tempo real** das altera√ß√µes
- **Bot√£o de reset** para restaurar tema padr√£o
- **Aplica√ß√£o autom√°tica** em frontend principal e widget embarc√°vel

#### üìä Dashboards Profissionais

**Dashboard Super Admin:**
- 5 KPIs globais:
  - Total de empresas cadastradas
  - Total de usu√°rios cadastrados
  - Usu√°rios online no momento
  - Conversas ativas no dia
  - Total de mensagens trocadas no dia
- 4 gr√°ficos interativos (Chart.js):
  - Usu√°rios online por hora (√∫ltimas 24h)
  - Conversas por hora (√∫ltimas 24h)
  - Mensagens por hora (√∫ltimas 24h)
  - Top 5 empresas mais ativas
- Tabela de empresas com estat√≠sticas detalhadas
- Filtro por empresa nos gr√°ficos
- Acesso direto ao tema de cada cliente
- Atalhos para gest√£o de empresas e inst√¢ncias

**Dashboard Admin Cliente:**
- 5 KPIs da inst√¢ncia:
  - Total de usu√°rios
  - Usu√°rios online
  - Conversas ativas no dia
  - Mensagens trocadas no dia
  - Taxa m√©dia de resposta
- 4 gr√°ficos interativos (Chart.js):
  - Usu√°rios online por hora (√∫ltimas 24h)
  - Conversas por hora (√∫ltimas 24h)
  - Mensagens por hora (√∫ltimas 24h)
  - Equipes mais ativas
- 4 atalhos r√°pidos:
  - Personaliza√ß√£o Visual
  - Gerenciar Usu√°rios
  - Gerenciar Equipes
  - Ir para o Chat
- Relat√≥rio de acessos √†s conversas
- Hor√°rios de pico de atividade

#### üß≠ Navega√ß√£o Aprimorada
- **Sidebar lateral** com menu din√¢mico por role
- **Dropdown "Configura√ß√µes"** no Navbar
- **Logo customizado** exibido no Navbar
- **Link home din√¢mico** (redireciona para dashboard apropriado)
- **Layout responsivo** com DashboardLayout
- **Notifica√ß√µes visuais** no √≠cone do chat
- **Navega√ß√£o intuitiva** entre se√ß√µes

#### üîß Backend - Novos Endpoints

**Admin (12 endpoints):**
- `GET /api/admin/estatisticas/geral` - Estat√≠sticas gerais da inst√¢ncia
- `GET /api/admin/estatisticas/usuarios-online` - Usu√°rios online por hora
- `GET /api/admin/estatisticas/conversas` - Conversas por hora
- `GET /api/admin/estatisticas/mensagens` - Mensagens por hora
- `GET /api/admin/estatisticas/equipes` - Atividade por equipe
- `GET /api/admin/relatorios/acessos-conversas` - Acessos √†s conversas
- `GET /api/admin/relatorios/horarios-pico` - Hor√°rios de pico
- `GET /api/admin/tema` - Obter tema da inst√¢ncia
- `PUT /api/admin/tema` - Atualizar tema
- `PUT /api/admin/tema/logo` - Atualizar logo
- `POST /api/admin/tema/resetar` - Resetar tema
- `GET /api/admin/tema/logs` - Log de altera√ß√µes

**SuperAdmin (7 endpoints):**
- `GET /api/superadmin/estatisticas/geral` - Estat√≠sticas globais
- `GET /api/superadmin/estatisticas/usuarios-online` - Usu√°rios online (global)
- `GET /api/superadmin/estatisticas/conversas` - Conversas (global)
- `GET /api/superadmin/estatisticas/mensagens` - Mensagens (global)
- `GET /api/superadmin/estatisticas/empresas` - Detalhes por empresa
- `GET /api/superadmin/tema/:id` - Obter tema de uma inst√¢ncia
- `PUT /api/superadmin/tema/:id` - Atualizar tema de uma inst√¢ncia

#### üõ†Ô∏è Infraestrutura
- **Dockerfile** para backend (Node.js)
- **Dockerfile** para frontend (nginx)
- **docker-compose.yml** para orquestra√ß√£o
- **nginx.conf** otimizado para SPA

#### üìñ Documenta√ß√£o
- Estrutura `.docs/` reorganizada em 7 categorias:
  - `01-inicio/` - Guias de in√≠cio r√°pido
  - `02-arquitetura/` - Documenta√ß√£o t√©cnica
  - `03-widget/` - Widget embarc√°vel
  - `04-features/` - Documenta√ß√£o de features
  - `05-desenvolvimento/` - Hist√≥rico de desenvolvimento
  - `06-entregas/` - Documentos de entrega
  - `07-scripts/` - Scripts auxiliares
- `INDEX.md` naveg√°vel criado
- Documento de entrega v2.0 completo
- Plano de implementa√ß√£o detalhado (897 linhas)
- Sistema White-Label documentado (563 linhas)

### üîÑ Modificado

#### Frontend
- **App.vue**: Integra√ß√£o com `useTheme` para carregamento autom√°tico de tema
- **Navbar.vue**: 
  - Logo customizado
  - Dropdown de configura√ß√µes
  - Home route din√¢mico por role
- **AdminDashboard.vue**: Reescrito completamente com KPIs e gr√°ficos
- **SuperAdminDashboard.vue**: Reescrito completamente com vis√£o global
- **Usuarios.vue**: Modal de token de widget integrado

#### Backend
- **authService.js**: Inclui tema no payload de login/me
- **admin.routes.js**: 12 novas rotas adicionadas
- **superadmin.routes.js**: 7 novas rotas adicionadas

#### Widget
- **ChatWidget.vue**: Aplica tema automaticamente do token JWT
- **WidgetMinimized.vue**: Corrigido nome do remetente
- **WidgetExpanded.vue**: Modal Nova Conversa com grupos

### üêõ Corrigido

- **[CR√çTICO]** Caractere Unicode invis√≠vel em `temaService.criarTemaPadrao()`
- **[CR√çTICO]** `req.usuario` ‚Üí `req.user` padronizado em todos controllers
- **[M√âDIO]** Valida√ß√£o de `req.user` em todos endpoints de estat√≠sticas
- **[M√âDIO]** Nome do remetente no widget minimizado
- **[BAIXO]** Modal "Nova Conversa" n√£o carregava usu√°rios no widget
- **[BAIXO]** Modal "Nova Conversa" n√£o exibia no widget

### üóÑÔ∏è Database

#### Novas Migrations
- `20251017020000-add-user-widget-token.js` - Tokens de widget
- `20251018100000-create-tema-instancia.js` - Temas de inst√¢ncia
- `20251018100100-create-tema-logs.js` - Logs de altera√ß√µes de tema

#### Novos Models
- **TemaInstancia** - Armazena configura√ß√µes de tema por inst√¢ncia
- **TemaLog** - Auditoria de altera√ß√µes de tema
- **Usuario** - Campos `widget_token`, `widget_token_expira_em`, `widget_token_sempre_valido`

### üì¶ Depend√™ncias

#### Frontend
- **Adicionado**: `chart.js@^4.4.0` - Gr√°ficos interativos

### üìä Estat√≠sticas da Release

```
Commits:              16 (total: 69)
Arquivos alterados:   90
Linhas adicionadas:   +9.858
Linhas removidas:     -117
L√≠quido:              +9.741

Novos arquivos:       22
Migrations:           3
Models:               2
Controllers:          5
Services:             4
Componentes Vue:      13
Composables:          2
Views:                2
```

### üîó Links Importantes

- [Documento de Entrega v2.0](.docs/06-entregas/16-ENTREGA_v2.0_DASHBOARDS.md)
- [Plano de Implementa√ß√£o](.docs/05-desenvolvimento/PLANO_MELHORIAS_DASHBOARDS.md)
- [Sistema White-Label](.docs/04-features/SISTEMA_WHITE_LABEL.md)
- [√çndice da Documenta√ß√£o](.docs/INDEX.md)

### üéØ Breaking Changes

Nenhum breaking change nesta release. Totalmente retrocompat√≠vel com v1.4.

### üöÄ Como Atualizar

```bash
# 1. Atualizar c√≥digo
git pull origin main

# 2. Instalar depend√™ncias do frontend
cd frontend
npm install

# 3. Rodar migrations
cd ../backend
npm run migrate

# 4. Reiniciar servidores
npm run dev
```

---

## [1.4] - 2025-10-17

### ‚ú® Adicionado

#### Sistema de Tokens de Widget
- Tokens permanentes para usu√°rios
- Gest√£o de tokens com expira√ß√£o configur√°vel
- Checkbox "Sempre v√°lido" para tokens sem expira√ß√£o
- Modal de gerenciamento de tokens na interface admin
- Endpoint para gerar token: `POST /api/admin/usuarios/:id/gerar-token-widget`
- Endpoint para obter token: `GET /api/admin/usuarios/:id/token-widget`
- Endpoint para revogar token: `DELETE /api/admin/usuarios/:id/token-widget`

#### Widget - Modal Nova Conversa
- Cria√ß√£o de grupos diretamente no widget
- Sele√ß√£o de m√∫ltiplos usu√°rios
- Campo de nome do grupo
- Mesmas funcionalidades do chat principal

### üêõ Corrigido

- Nome do remetente incorreto quando widget minimizado
- Modal "Nova Conversa" n√£o carregava usu√°rios no widget
- Modal n√£o aparecia ao clicar em "+" no widget

### üìñ Documenta√ß√£o

- Guia completo de gerenciamento de tokens de widget
- Resumo visual final v1.4
- Documento de entrega consolidado v1.4

---

## [1.3] - 2025-10-15

### ‚ú® Adicionado

#### Chat Widget Embarc√°vel
- Widget completo em 2 linhas de c√≥digo
- Estados: minimizado, expandido, offline
- Integra√ß√£o via script tag
- Autentica√ß√£o via token JWT
- Real-time com Socket.IO
- Notifica√ß√µes de novas mensagens
- Indicador de mensagens n√£o lidas

### üìñ Documenta√ß√£o

- Guia de integra√ß√£o do widget
- Exemplos de implementa√ß√£o
- Scripts de teste
- Entrega final v1.3

---

## [1.0] - 2025-10-10

### ‚ú® Adicionado

#### Features Principais
- Chat em tempo real com Socket.IO
- Conversas 1-on-1 e grupos
- Status de mensagens (enviado ‚úì, entregue ‚úì‚úì, lido ‚úì‚úì verde)
- Multi-tenancy robusto
- Sistema de permiss√µes (Super Admin, Admin Cliente, Usu√°rio)
- Gest√£o de empresas e inst√¢ncias
- Gest√£o de usu√°rios e equipes
- Autentica√ß√£o JWT
- Upload de imagens
- Busca de mensagens
- Notifica√ß√µes em tempo real

#### Backend
- API RESTful completa
- Socket.IO para real-time
- SQLite com Sequelize ORM
- Middlewares de seguran√ßa
- Valida√ß√£o de tenant
- Logs estruturados

#### Frontend
- Vue.js 3 com Composition API
- Pinia para state management
- Vite para build
- Interface moderna e responsiva
- Componentes reutiliz√°veis

### üìñ Documenta√ß√£o

- Arquitetura completa
- Modelo de dados
- Requisitos funcionais
- Guia de desenvolvimento
- Como rodar o projeto

---

## Tipos de Mudan√ßas

- `‚ú® Adicionado` - Novas funcionalidades
- `üîÑ Modificado` - Mudan√ßas em funcionalidades existentes
- `üêõ Corrigido` - Corre√ß√µes de bugs
- `üóëÔ∏è Removido` - Funcionalidades removidas
- `üîí Seguran√ßa` - Corre√ß√µes de vulnerabilidades
- `üì¶ Depend√™ncias` - Atualiza√ß√µes de depend√™ncias
- `üóÑÔ∏è Database` - Mudan√ßas no banco de dados
- `üìñ Documenta√ß√£o` - Mudan√ßas na documenta√ß√£o
- `üéØ Breaking Changes` - Mudan√ßas incompat√≠veis com vers√µes anteriores

---

**Formato de versionamento:** [MAJOR.MINOR.PATCH]
- **MAJOR**: Mudan√ßas incompat√≠veis na API
- **MINOR**: Novas funcionalidades (retrocompat√≠veis)
- **PATCH**: Corre√ß√µes de bugs (retrocompat√≠veis)

